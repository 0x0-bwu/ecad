import os
import sys
from sys import platform

cwd = os.getcwd()
debug_mode = True

# Build dir
build_dir = os.path.abspath(cwd + '/build')
program_name = build_dir + '/thermal_test.exe'

# Compile flags
cxx_flags = [
    "-g",
    "-Wall",
    "-w",
    "-Wl,-rpath,\$$ORIGIN",
    "-std=c++17",
    "-fopenmp",
    "-lpthread",
]

if debug_mode :
    cxx_flags.append(["-g", "-O0"])
else :
    cxx_flags.append(["-s", "-O0", "-DNDEBUG"])

# Thirdpart
## boost
boost_include_path = '/usr/local/include'
boost_library_path = '/usr/local/lib'

## mfsolver
mfsolver_support = False
mfsolver_path = os.path.abspath(cwd + '/../../internal/mfsolver')

## thirdpart
thirdpart_lib_path = cwd + '/../../libs'

## os
linux_library_path = '/usr/lib/x86_64-linux-gnu'

# Include dirs
cpp_path = [
    '/usr/include',
    cwd,
    cwd + '/..',
    cwd + '/../..',
    cwd + '/../../eigen3',
]

##boost
cpp_path.append(boost_include_path)

if mfsolver_support :
    cpp_path.append(mfsolver_path + "/mf2/include")
    cpp_path.append(mfsolver_path + "/mf2/include/core")

# Build dir
build_path = os.path.abspath(cwd + '/build')

source_files = [
    'test.cpp'
]

libs_name = [
    'pthread',
    'png',
    'omp'
]

libs_path = [build_dir, boost_library_path, thirdpart_lib_path, linux_library_path]

# mfsolver
if mfsolver_support :
    libs_path.append(mfsolver_path + '/mf2/lib')
    libs_path.append(mfsolver_path + '/mkl/lib')

    libs_name += [
        'mkl_intel_lp64',
        'mkl_sequential',
        'mkl_core',
        'ifcoremt',
        'imf',
        'iomp5',
        'irc',
        'intlc',
        'svml',
        'cublas',
        'cublasLt',
        'cudart',
        'ansmf',
        'ngcore'    
    ]   

rpath = libs_path
env = Environment()
env.Append(CPPPATH=cpp_path)
env.Append(CXXFLAGS=cxx_flags)
env.Program(program_name,source_files,LIBS=libs_name,LIBPATH=libs_path,RPATH=rpath)