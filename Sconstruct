
import os
import sys
from sys import platform

cwd = os.getcwd()
debug_mode = True

# Compile flags
cxx_flags = [
    "-g",
    "-Wall",
    "-w",
    "-Wl,-rpath,\$$ORIGIN",
    "-std=c++17",
    "-fopenmp",
    "-lpthread",
]

if debug_mode :
    cxx_flags.append(["-g", "-O0"])
else :
    cxx_flags.append(["-s", "-O0", "-DNDEBUG"])

# Thirdpart
## boost
boost_include_path = '/usr/local/include'
boost_library_path = '/usr/local/lib'
boost_python_support = True
boost_python_version = 3.6

## mfsolver
mfsolver_support = False
mfsolver_path = os.path.abspath(cwd + '/thirdpart/internal/mfsolver')

## thirdpart
thirdpart_lib_path = cwd + '/thirdpart/libs'

# Include dirs
python_include_path = '/usr/include/python' + str(boost_python_version)
cpp_path = [
    '/usr/include',
    python_include_path,
    cwd + '/src',
    cwd + '/thirdpart',
    cwd + '/thirdpart/eigen3',
]
cpp_path.append(boost_include_path)
if mfsolver_support :
    cpp_path.append(mfsolver_path + "/mf2/include")
    cpp_path.append(mfsolver_path + "/mf2/include/core")

# Build dir
build_path = os.path.abspath(cwd + '/build')

#Environment
main_env = Environment()
main_env.Append(CPPPATH=cpp_path)
main_env.Append(CXXFLAGS=cxx_flags)
main_env.Append(BUILDPATH=build_path)
main_env.Append(MFSOLVERSUPPORT=mfsolver_support)
main_env.Append(BOOSTINCLUDEPATH=boost_include_path)
main_env.Append(BOOSTLIBRARYPATH=boost_library_path)
main_env.Append(BOOSTPYTHONSUPPORT=boost_python_support)
main_env.Append(BOOSTPYTHONVERSION=boost_python_version)
main_env.Append(THIRDPARTLIBPATH=thirdpart_lib_path)

if mfsolver_support :
    main_env.Append(MFSOLVERPATH=mfsolver_path)

# SCONS scripts to build
build_scripts = [
    'src/SConscript',  
    'test/SConscript'
]

for script in build_scripts:
    env = main_env.Clone()
    SConscript(script, exports='env')