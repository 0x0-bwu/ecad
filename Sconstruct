
import os
import sys
from sys import platform

cwd = os.getcwd()
debug_mode = True

# Compile flags
cxx_flags = [
    "-g",
    "-Wall",
    "-w",
    "-Wl,-rpath,\$$ORIGIN",
    "-std=c++17",
    "-fopenmp",
    "-lpthread"
]

if debug_mode :
    cxx_flags.append([
        "-g",
        "-O0"
    ])
else :
    cxx_flags.append([
        "-s",
        "-O0",
        "-DNDEBUG"
    ])

# Include dirs
cpp_path = [
    '/usr/include',
    cwd + '/src',
    cwd + '/thirdpart',
    cwd + '/thirdpart/eigen3',
]

# Thirdpart
mfsolver_support = False
mfsolver_path = os.path.abspath(cwd + '/thirdpart/internal/mfsolver')

if mfsolver_support :
    cpp_path.append(mfsolver_path + "/mf2/include")
    cpp_path.append(mfsolver_path + "/mf2/include/core")

# Build dir
build_path = os.path.abspath(cwd + '/build')

#Environment
main_env = Environment()
main_env.Append(CXXFLAGS=cxx_flags)
main_env.Append(CPPPATH=cpp_path)
main_env.Append(BUILDPATH=build_path)
main_env.Append(MFSOLVERSUPPORT=mfsolver_support)

if mfsolver_support :
    main_env.Append(MFSOLVERPATH=mfsolver_path)

# SCONS scripts to build
build_scripts = [
    'src/SConscript',  
    'test/SConscript'
]

for script in build_scripts:
    env = main_env.Clone()
    SConscript(script, exports='env')